<test>

	<name>PCRF_ReqId-1005.TC.004.xml</name>
	<description>Validate WebService when call is corrupted, missing parameters</description>

	<!--
	1. Start XTT SMSC Server and wait for SMSC binding.
	- wait for SMSNOTIFICATION
	- validate the Notification Message
	- Stop XTT SMSC Server
	2. Start XTT DIAMETER Server.
	- INFO: Exchange of DWR/DWA: DWR initiated by DIAMETER-OUT PCRF and automatically responded with DWA by XTT Server
	3. Wait for CER: Exchange of CER/CEA. CER initiated by DIAMETER-OUT PCRF and automatically responded with CEA by XTT Server
	4. XTT DIAMETER Client opens connection "one" to PCRF listetning port.
	5. XTT DIAMETER Client sends CER and receives CEA.
	6. XTT DIAMETER Client sends CCR and receives CCA.
    7. Corrupted SOAP Request - Using updateRules method send request XMP.
    8. check Response Code.
    9. Stop Diameter Server
	
	-->

	<function name="executeRemoteXMSCommand" module="Remote">
		<parameter>
			<configuration>remote/command</configuration>
			<parameter>uname -n</parameter>
		</parameter>
	</function>

	<function name="queryResponse" module="Remote">
		<parameter>(.*)</parameter>
		<parameter>response</parameter>
	</function>

	<function name="queryText" module="Basic">
		<variable>response</variable>
		<parameter>hostname</parameter>
		<parameter>\w++.</parameter>
	</function>

	<!-- Start SMSC and wait for SMSNOTIFICATION in a separate thread. -->
	<function name="startSMSCServer" module="SMS"/>
	<function name="waitForBind" module="SMS"/>

	<thread>
		<!-- Wait for timedout SMS-OUT Notification for 0787367401 -->
		<function name="waitForTimeoutMessages" module="SMS">
			<configuration>SMSCServer/waitTimeout</configuration>
		</function>

		<!-- Stop SMSC Server -->
		<function name="stopSMSCServer" module="SMS"/>
	</thread>


	<!-- start DIAMETER Server -->
	<!--  Exchange of CER/CEA: CER initiated by DIAMETER-OUT PCRF and automatically responded with CEA by XTT Server. -->
	<!--  Exchange of DWR/DWA: DWR initiated by DIAMETER-OUT PCRF and automatically responded with DWA by XTT Server. -->
	<function name="startDiameterServer" module="Diameter">
		<configuration>DiameterServer/PORT</configuration>
		<xml>
			<Diameter>
				<response>
					<DEVICE_WATCHDOG_REQUEST proxiable="true" error="false" tretr="false">
						<RESULT_CODE        value="DIAMETER_SUCCESS"    mandatory="true" protected="false" vendorspecific="false"  vendorID=""/>
						<ORIGIN_HOST            value="diameter.xtt724.com" mandatory="true" protected="false" vendorspecific="false"  vendorID=""/>
						<ORIGIN_REALM           value="ORIGIN_REALM"        mandatory="true" protected="false" vendorspecific="false"  vendorID=""/>
					</DEVICE_WATCHDOG_REQUEST>
					<CAPABILITIES_EXCHANGE_REQUEST proxiable="true" error="false" tretr="false">
						<RESULT_CODE            value="DIAMETER_SUCCESS"    mandatory="true" protected="false" vendorspecific="false"  vendorID=""/>
						<ORIGIN_HOST            value="diameter.xtt724.com" mandatory="true" protected="false" vendorspecific="false"  vendorID=""/>
						<ORIGIN_REALM           value="ORIGIN_REALM"        mandatory="true" protected="false" vendorspecific="false"  vendorID=""/>
						<VENDOR_ID              request="VENDOR_ID" />
						<PRODUCT_NAME           request="PRODUCT_NAME" />
						<SUPPORTED_VENDOR_ID    request="SUPPORTED_VENDOR_ID" />
						<AUTH_APPLICATION_ID    request="AUTH_APPLICATION_ID" />
					</CAPABILITIES_EXCHANGE_REQUEST>
					<RE_AUTH_REQUEST proxiable="true" error="false" tretr="false">
						<SESSION_ID             request="SESSION_ID"/>
						<AUTH_APPLICATION_ID    value="16777238"                   mandatory="true" protected="false" vendorspecific="false"  vendorID=""/>
						<RESULT_CODE            value="DIAMETER_SUCCESS"    mandatory="true" protected="false" vendorspecific="false"  vendorID=""/>
						<ORIGIN_HOST            value="diameter.xtt724.com" mandatory="true" protected="false" vendorspecific="false"  vendorID=""/>
						<ORIGIN_REALM           value="ORIGIN_REALM"        mandatory="true" protected="false" vendorspecific="false"  vendorID=""/>
					</RE_AUTH_REQUEST> 
				</response>
			</Diameter>
		</xml>
		<!--
		<configuration>DIAMETERSERVER/Timeout</configuration>
		-->
		<parameter>120000</parameter>
	</function>

	<!-- Wait for CER from PCRF-->
	<function name="waitForSpecificRequests" module="Diameter">
		<parameter>6868</parameter>
		<parameter>257</parameter>
		<parameter>1</parameter>
	</function>



	<!-- XTT DIAMETER Client opens connection "one" to PCRF listetning port. -->
	<function name="createConnection" module="Diameter">
		<parameter>one</parameter>
		<configuration>DIAMETERCLIENT/IP</configuration>
		<configuration>DIAMETERCLIENT/PORT</configuration>
	</function>

	<!--  XTT DIAMETER Client sends CER and receives CEA -->
	<function name="sendDiameterRequest" module="Diameter">
		<parameter>one</parameter>
		<xml>
			<CAPABILITIES_EXCHANGE_REQUEST version="1"  overrideCommandCode="257" applicationID="16777238" hopbyhopID="456" endtoendID="789" proxiable="true" error="false" tretr="false">
				<SESSION_ID overrideAVPCode="" value="SESSION_ID;xtt@724.com;A1_B" mandatory="true" protected="false" vendorspecific="false" vendorID="" />
				<VENDOR_ID  value="10415" mandatory="true" protected="false" vendorspecific="false" vendorID="" />
				<ORIGIN_REALM           value="ORIGIN_REALM"        mandatory="true" protected="false" vendorspecific="false"  vendorID=""/>
				<ORIGIN_HOST            value="diameter.xtt724.com" mandatory="true" protected="false" vendorspecific="false"  vendorID=""/>
				<HOST_IP_ADDRESS        value="0001AC140983" mandatory="true" protected="false" vendorspecific="false"  vendorID=""/>
				<PRODUCT_NAME           value="PRODUCT_NAME" mandatory="true" protected="false" vendorspecific="false"  vendorID=""/>
				<SUPPORTED_VENDOR_ID    value="10415" mandatory="true" protected="false" vendorspecific="false"  vendorID="" />
				<AUTH_APPLICATION_ID    value="16777238" mandatory="true" protected="false" vendorspecific="false"  vendorID="" />
			</CAPABILITIES_EXCHANGE_REQUEST>
		</xml>
		<parameter>STORERESULT</parameter>
	</function>

	<!-- Headers validation of CEA commandcode 257 -->
	<function name="compareString" module="Basic">
		<variable>DIAMETER/one/HEADER/commandcode</variable >
		<parameter>257</parameter>
	</function>

	<!-- AVP validation of CEA -->
	<function name="compareString" module="Basic">
		<variable>DIAMETER/one/AVP/RESULT_CODE</variable>
		<parameter>2001</parameter>
	</function>

	<!-- XTT DIAMETER Client sends CCR and receives CCA. -->
	<function name="sendDiameterRequest" module="Diameter">
		<parameter>one</parameter>
		<xml>
		<CREDIT_CONTROL_REQUEST version="1" overrideCommandCode="272" applicationID="16777238" hopbyhopID="456" endtoendID="789" proxiable="true" error="false" tretr="false">
				<SESSION_ID             value="SESSION_ID;xtt@724.com;A1_B"/>
				<ORIGIN_HOST            value="diameter.xtt724.com" mandatory="true" protected="false" vendorspecific="false"  vendorID=""/>
				<ORIGIN_REALM           value="ORIGIN_REALM" mandatory="true" protected="false" vendorspecific="false"  vendorID=""/>
				<DESTINATION_REALM      value="DESTINATION_REALM" mandatory="true" protected="false" vendorspecific="false"  vendorID=""/>
				<AUTH_APPLICATION_ID    value="16777238" mandatory="true" protected="false" vendorspecific="false"  vendorID="" />
				<CC_REQUEST_TYPE        value="INITIAL_REQUEST"   mandatory="true" protected="false" vendorspecific="false"  vendorID=""/>
				<CC_REQUEST_NUMBER      value="0" mandatory="true" protected="false" vendorspecific="false"  vendorID=""/>
				<IP_CAN_TYPE            value="00000000" overrideavpcode="1027" mandatory="false" protected="false" vendorspecific="true"  vendorID="10415"/>
				<RAT_TYPE               value="00010000" overrideavpcode="1032" mandatory="false" protected="false" vendorspecific="true"  vendorID="10415"/>
				<FRAMED_IP_ADDRESS      value="0a043c34" overrideavpcode="8" mandatory="true" protected="false" vendorspecific="false"  vendorID=""/>
				<SUBSCRIPTION_ID         mandatory="true" protected="false" vendorspecific="false"  vendorID="">
					<SUBSCRIPTION_ID_TYPE  value="00000000"   mandatory="true" protected="false" vendorspecific="false"  vendorID=""/>  //END_USER_E164=0   END_USER_IMSI=1   END_USER_SIP_URI=2   END_USER_NAI=3   END_USER_PRIVATE=4
					<SUBSCRIPTION_ID_DATA  value="0787367401"       mandatory="true" protected="false" vendorspecific="false"  vendorID=""/>
				</SUBSCRIPTION_ID>
			</CREDIT_CONTROL_REQUEST>
		</xml>
		<parameter>STORERESULT</parameter>
	</function>

	<!-- Headers validation of CCA commandcode 272 -->
	<function name="compareString" module="Basic">
		<variable>DIAMETER/one/HEADER/commandcode</variable >
		<parameter>272</parameter>
	</function>

	<!-- AVP validation of CCA -->
	<function name="compareString" module="Basic">
		<variable>DIAMETER/one/AVP/RESULT_CODE</variable>
		<parameter>2001</parameter>
	</function>

	<!-- AVP validation of CCA -->
	<function name="queryText" module="Basic">
		<variable>DIAMETER/one/AVP/Unknown(1002)</variable>
		<parameter>var1</parameter>
		<parameter>000003EDC0000018000028AF44656661756C745F52756C65</parameter> //matches the Charging-Rule-Name AVP with value: 44656661756C745F52756C65 = Default_Rule 
	</function>

	<!-- AVP validation of CCA -->
	<function name="queryText" module="Basic">
		<variable>DIAMETER/one/AVP/Unknown(1001)</variable> //Charging-Rule-Install
		<parameter>var1</parameter>
		<parameter>000003EDC000001A000028AF436F6E74726F6C6C65645F516F530000</parameter> //matches the Charging-Rule-Name AVP with value: 436F6E74726F6C6C65645F516F530000 = Controlled_Qos
	</function>

	<!-- Make sure the session information has been added to PRESENCE-STORE. -->
	<function name="executeRemoteXMSCommand" module="Remote">
		<parameter>
			<configuration>remote/command</configuration>
			<parameter>pse3cli -a 0787367401 -t SubscriberId rba TI:F.CEE.PRESENCE-STORE:PSE3</parameter>
		</parameter>
	</function>

	<function name="queryResponse" module="Remote">
		<parameter>&lt;addressType&gt;GxSessionId&lt;/addressType&gt;</parameter>
		<parameter>response</parameter>
	</function>

  <!-- Corrupted SOAP Request - Using updateRules method -->
        <function name="SOAPClient" module="SOAP_API">
        <parameter>
            <parameter>http://</parameter>
            <configuration>XMP/IP</configuration>
            <parameter>:</parameter>
            <configuration>XMP/PORT</configuration>
            <parameter>/jaxws-pcrf/pcrf?wsdl</parameter>
        </parameter>
        <file>corrupted.xml</file>
        <parameter>Body/return</parameter>
    </function>

   <!-- check Response Code -->
    <function name="checkResponseCode" module="SOAP_API">
        <parameter>500</parameter>
    </function>

        <!-- Wait for CER from PCRF-->
        <function name="waitForSpecificRequests" module="Diameter">
                <parameter>6868</parameter>
                <parameter>257</parameter>
                <parameter>1</parameter>
        </function>


              	<!-- Stopping Diameter Server -->
		<function name="stopDiameterServer" module="Diameter" />
</test>
